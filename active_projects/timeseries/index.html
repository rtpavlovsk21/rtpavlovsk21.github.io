<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Series Plot</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
    <div id="plotly-div"></div>

    <script>
       // Helper function to convert millisecond epoch to ISO string
function epochToISO(epochMillis) {
    return new Date(epochMillis).toISOString(); 
}

// Fetch the JSON data and plot
fetch('./data_points.json')
    .then(response => response.json())
    .then(data => {
        let traces = [];
        let layout = {
            title: 'Multiple Time Series with Individual Axes in Plotly',
            xaxis: {
                autorange: true
            }
        };

        // Extracting epoch times and converting to ISO format
        let xValues = data["epoch_times"].map(epochToISO);
        
        // Iterate over all keys in the JSON data (excluding "epoch_times")
        Object.keys(data).forEach((key, index) => {
            if (key !== "epoch_times") {
                let yAxisName = 'y' + (index + 1);
                let side = index === 0 ? 'left' : 'right';

                // Create trace for the data series
                traces.push({
                    type: "scatter",
                    mode: "lines",
                    name: key,
                    x: xValues,
                    y: data[key].map(Number), // Convert string values to numbers
                    yaxis: yAxisName,
                    line: {color: index === 0 ? '#17BECF' : '#7F7F7F'}
                });

                // Create Y-axis for the data series
                layout[yAxisName] = {
                    autorange: true,
                    side: side,
                    overlaying: index === 0 ? undefined : 'y',
                    title: key
                };

                // Offset subsequent y-axes to avoid overlap
                if (index > 0) {
                    layout[yAxisName].anchor = 'free';
                    layout[yAxisName].position = 1 - 0.15 * index;
                }
            }
        });

        // Plot the data
        Plotly.newPlot('plotly-div', traces, layout);
    });
    </script>
</body>

</html>